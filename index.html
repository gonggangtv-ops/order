<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Voice POS</title>
    <style>
        :root { --primary: #3f72af; --bg: #f5f7fa; --text: #333; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--text); }
        
        /* Navigation Tab */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .nav-item { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-weight: bold; color: #666; }
        .nav-item.active { color: var(--primary); border-top: 3px solid var(--primary); }

        /* Main Screen Container */
        .screen { display: none; padding: 20px; padding-bottom: 80px; }
        .screen.active { display: block; }

        /* Card & UI Elements */
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .printer-card { border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-voice { background: #e74c3c; color: white; height: 80px; font-size: 20px; border-radius: 40px; }
        .btn-print { background: #27ae60; color: white; font-size: 18px; }
        
        /* Modal */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; }
        .modal-content { background:white; padding:20px; border-radius:10px; width:85%; }
        input { width:100%; padding:12px; margin:10px 0; border:1px solid #ddd; border-radius:8px; box-sizing:border-box; }
    </style>
</head>
<body>

<div id="screen-order" class="screen active">
    <h2>üìù ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h2>
    <div class="card">
        <label>‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞:</label>
        <input type="number" id="table-no" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5" style="font-size: 24px;">
    </div>
    <div class="card" id="order-list" style="min-height: 150px; font-size: 18px;">
        <p style="color:#999;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ...</p>
    </div>
    <button class="btn btn-voice" onclick="startVoice()">üé§ ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î‡πÄ‡∏°‡∏ô‡∏π</button>
    <button class="btn btn-print" style="margin-top:20px;" onclick="printOrder()">üñ®Ô∏è ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ß</button>
</div>

<div id="screen-settings" class="screen">
    <h2>‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</h2>
    <div class="card">
        <div id="printer-display-list">
            </div>
        <button class="btn" style="background:var(--primary); color:white;" onclick="openModal()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå (LAN)</button>
    </div>
</div>

<div class="modal" id="printerModal">
    <div class="modal-content">
        <h3>‡πÅ‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏°‡πà</h3>
        <input type="text" id="p-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏£‡∏±‡∏ß)">
        <input type="text" id="p-ip" placeholder="IP Address (‡πÄ‡∏ä‡πà‡∏ô 192.168.1.78)">
        <button class="btn" style="background:var(--primary); color:white;" onclick="addPrinter()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</button>
        <button onclick="closeModal()" style="background:none; border:none; width:100%; margin-top:10px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('order')">üõí ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>
    <div class="nav-item" onclick="switchTab('settings')">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>
</div>

<script>
    let printers = JSON.parse(localStorage.getItem('my_printers')) || [];
    let currentOrders = [];

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    function switchTab(tab) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('screen-' + tab).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
    function openModal() { document.getElementById('printerModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('printerModal').style.display = 'none'; }

    function addPrinter() {
        const name = document.getElementById('p-name').value;
        const ip = document.getElementById('p-ip').value;
        if(name && ip) {
            printers.push({ name, ip });
            localStorage.setItem('my_printers', JSON.stringify(printers));
            renderPrinters();
            closeModal();
        }
    }

    function renderPrinters() {
        const list = document.getElementById('printer-display-list');
        list.innerHTML = printers.length ? '' : '<p style="color:#999;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</p>';
        printers.forEach((p, i) => {
            list.innerHTML += `
                <div class="printer-card">
                    <div><strong>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå${p.name}</strong><br><small style="color:#999;">${p.ip}</small></div>
                    <button onclick="removePrinter(${i})" style="color:red; border:none; background:none;">‡∏•‡∏ö</button>
                </div>`;
        });
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'th-TH';

    function startVoice() { recognition.start(); }
    recognition.onresult = (e) => {
        const text = e.results[0][0].transcript;
        currentOrders.push(text);
        const list = document.getElementById('order-list');
        list.innerHTML = currentOrders.map((o, i) => `<div>${i+1}. ${o}</div>`).join('');
    };

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏¢‡∏¥‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏∏‡∏∂‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏≠‡∏î‡πÑ‡∏ß‡πâ)
    async function printOrder() {
        if(printers.length === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
        const table = document.getElementById('table-no').value;
        let bill = `‡πÇ‡∏ï‡πä‡∏∞: ${table}\n----------\n` + currentOrders.join('\n') + `\n----------\n\n\n`;

        for(let p of printers) {
            fetch(`http://${p.ip}/cgi-bin/print`, { method: 'POST', mode: 'no-cors', body: bill });
        }
        alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå " + printers.length + " ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        currentOrders = [];
        document.getElementById('order-list').innerHTML = '<p style="color:#999;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ...</p>';
    }

    function removePrinter(i) {
        printers.splice(i, 1);
        localStorage.setItem('my_printers', JSON.stringify(printers));
        renderPrinters();
    }

    renderPrinters();
</script>
</body>
</html>
