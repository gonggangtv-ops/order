<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xprinter XP-80T Voice POS</title>
    <style>
        :root { --primary: #3f72af; --secondary: #112d4e; --bg: #f9f7f7; --success: #28a745; --danger: #dc3545; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; overflow-x: hidden; }
        
        /* Layout Sidebar & Main */
        .wrapper { display: flex; height: 100vh; flex-direction: column; }
        .header { background: var(--primary); color: white; padding: 15px; font-weight: bold; display: flex; align-items: center; justify-content: space-between; }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 200px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; }
        .menu-item { padding: 20px 15px; cursor: pointer; border-left: 5px solid transparent; transition: 0.3s; font-size: 14px; }
        .menu-item.active { background: #dbe2ef; color: var(--primary); border-left-color: var(--primary); font-weight: bold; }

        /* Content Area */
        .content { flex: 1; padding: 20px; overflow-y: auto; background: white; }
        .screen { display: none; }
        .screen.active { display: block; }

        /* Printer Cards Style (Based on your image) */
        .printer-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card { border: 1px solid #ddd; border-radius: 10px; padding: 15px; background: #fff; position: relative; transition: 0.2s; }
        .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .card.add-new { border: 2px dashed var(--primary); color: var(--primary); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; min-height: 120px; }
        .status-tag { float: right; color: var(--success); font-size: 12px; font-weight: bold; }
        .btn-group { display: flex; gap: 5px; margin-top: 15px; }
        .btn-s { flex: 1; padding: 8px; border: 1px solid var(--primary); background: #fff; color: var(--primary); border-radius: 5px; cursor: pointer; font-size: 12px; }

        /* Voice Order Screen Style */
        .voice-box { text-align: center; padding: 20px; }
        .btn-mic { background: var(--danger); color: white; width: 100px; height: 100px; border-radius: 50%; border: none; font-size: 30px; cursor: pointer; box-shadow: 0 4px 15px rgba(220,53,69,0.4); margin-bottom: 20px; }
        .btn-mic.listening { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(220,53,69,0.7); } 70% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(220,53,69,0); } 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(220,53,69,0); } }
        #order-preview { background: #f1f1f1; border-radius: 10px; padding: 15px; min-height: 150px; text-align: left; font-size: 18px; margin-bottom: 20px; border: 1px solid #ccc; }

        /* Modal */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-body { background: white; padding: 25px; border-radius: 12px; width: 320px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn-main { background: var(--primary); color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="header">
        <span>‚ò∞ ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ POS</span>
        <span id="clock" style="font-size: 14px;"></span>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="menu-item active" onclick="showScreen('settings')">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≠‡∏û‡πà‡∏ß‡∏á</div>
            <div class="menu-item" onclick="showScreen('order')">üé§ ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á</div>
            <div class="menu-item">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏•‡∏≤‡∏ß‡∏î‡πå</div>
            <div class="menu-item">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</div>
        </div>

        <div class="content">
            
            <div id="screen-settings" class="screen active">
                <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
                <div class="printer-grid" id="printer-list">
                    <div class="card add-new" onclick="openModal()">
                        <span style="font-size: 24px;">+</span>
                        <strong>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</strong>
                        <small>USB, Bluetooth ‡∏´‡∏£‡∏∑‡∏≠ LAN</small>
                    </div>
                </div>
            </div>

            <div id="screen-order" class="screen">
                <div class="voice-box">
                    <h3>üé§ ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà <input type="number" id="table-input" style="width: 60px; font-size: 20px; border: none; border-bottom: 2px solid #333; text-align: center;" value="1"></h3>
                    <div id="order-preview">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ...</div>
                    <button id="mic-btn" class="btn-mic" onclick="startVoice()">üé§</button>
                    <p id="voice-status">‡πÅ‡∏ï‡∏∞‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î</p>
                    <button class="btn-main" style="background: var(--success); height: 60px; font-size: 20px;" onclick="printAll()">üñ®Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå (Auto-Cut)</button>
                    <button onclick="clearOrders()" style="margin-top: 15px; border: none; background: none; color: #999; cursor: pointer;">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal" id="printerModal">
    <div class="modal-body">
        <h3>‡πÅ‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå LAN</h3>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å (‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏£‡∏±‡∏ß):</label>
        <input type="text" id="p-name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠">
        <label>IP Address:</label>
        <input type="text" id="p-ip" placeholder="‡πÄ‡∏ä‡πà‡∏ô 192.168.1.78">
        <button class="btn-main" onclick="addPrinter()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</button>
        <button onclick="closeModal()" style="width: 100%; border: none; background: none; margin-top: 10px; color: #666;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
</div>

<script>
    let printers = JSON.parse(localStorage.getItem('saved_printers')) || [];
    let currentOrders = [];

    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        document.getElementById('screen-' + screenId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
    function openModal() { document.getElementById('printerModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('printerModal').style.display = 'none'; }

    function addPrinter() {
        const name = document.getElementById('p-name').value;
        const ip = document.getElementById('p-ip').value;
        if(name && ip) {
            printers.push({ name, ip });
            localStorage.setItem('saved_printers', JSON.stringify(printers));
            renderPrinters();
            closeModal();
        }
    }

    function renderPrinters() {
        const list = document.getElementById('printer-list');
        list.innerHTML = `<div class="card add-new" onclick="openModal()">
                            <span style="font-size: 24px;">+</span>
                            <strong>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</strong>
                            <small>LAN / IP</small>
                          </div>`;
        printers.forEach((p, i) => {
            list.innerHTML += `
                <div class="card">
                    <span class="status-tag">‚óè ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß</span>
                    <strong>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå${p.name}</strong>
                    <div style="color: #888; font-size: 13px; margin: 5px 0;">${p.ip} | ‚öÑ LAN</div>
                    <div class="btn-group">
                        <button class="btn-s" onclick="testPrint('${p.ip}')">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå</button>
                        <button class="btn-s" style="color:red; border-color:red;" onclick="removePrinter(${i})">‡∏•‡∏ö</button>
                    </div>
                </div>`;
        });
    }

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'th-TH';

    function startVoice() {
        recognition.start();
        document.getElementById('mic-btn').classList.add('listening');
        document.getElementById('voice-status').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á...";
    }

    recognition.onresult = (event) => {
        const result = event.results[0][0].transcript;
        currentOrders.push(result);
        updateOrderUI();
        document.getElementById('mic-btn').classList.remove('listening');
        document.getElementById('voice-status').innerText = "‡πÅ‡∏ï‡∏∞‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏π‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°";
    };

    function updateOrderUI() {
        const box = document.getElementById('order-preview');
        box.innerHTML = currentOrders.map((o, i) => `<div style="padding:5px 0; border-bottom:1px solid #ddd;">${i+1}. ${o}</div>`).join('');
    }

    // ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Xprinter XP-80T (ESC/POS)
    async function printAll() {
        if(printers.length === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Å‡πà‡∏≠‡∏ô");
        if(currentOrders.length === 0) return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£");

        const table = document.getElementById('table-input').value;
        const now = new Date().toLocaleString('th-TH');

        // ESC/POS Commands ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö XP-80T
        const init = "\x1B\x40";       // Reset printer
        const center = "\x1B\x61\x01"; // Align center
        const left = "\x1B\x61\x00";   // Align left
        const boldOn = "\x1B\x45\x01"; // Bold on
        const boldOff = "\x1B\x45\x00"; // Bold off
        const cut = "\x1D\x56\x41\x03"; // Full cut command

        let content = init + center + boldOn + "‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£\n" + boldOff;
        content += "‡πÇ‡∏ï‡πä‡∏∞: " + table + "\n";
        content += now + "\n";
        content += "--------------------------------\n" + left;
        currentOrders.forEach((o, i) => {
            content += (i+1) + ". " + o + "\n";
        });
        content += "--------------------------------\n\n\n" + cut;

        for(let p of printers) {
            try {
                // ‡∏¢‡∏¥‡∏á‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Xprinter Web Interface
                await fetch(`http://${p.ip}/cgi-bin/print`, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: content
                });
            } catch (e) { console.error("Error printing to " + p.ip); }
        }
        
        alert("‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        clearOrders();
    }

    function removePrinter(i) {
        printers.splice(i, 1);
        localStorage.setItem('saved_printers', JSON.stringify(printers));
        renderPrinters();
    }

    function clearOrders() {
        currentOrders = [];
        document.getElementById('order-preview').innerText = "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ...";
    }

    function testPrint(ip) {
        const testCmd = "\x1B\x40\x1B\x61\x01TEST PRINT SUCCESS\nXP-80T READY\n\n\n\x1D\x56\x41\x03";
        fetch(`http://${ip}/cgi-bin/print`, { method: 'POST', mode: 'no-cors', body: testCmd });
    }

    // ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString('th-TH'); }, 1000);
    
    renderPrinters();
</script>

</body>
</html>
