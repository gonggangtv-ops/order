<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice POS - Xprinter</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; margin: 0; padding: 15px; }
        .container { max-width: 450px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 15px; }
        h3 { margin-top: 0; color: #333; display: flex; align-items: center; }
        
        /* ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (Add Printer) */
        .setting-section { background: #e9ecef; border-left: 5px solid #0d6efd; }
        input[type="text"], input[type="number"] { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        /* ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ */
        #display-list { min-height: 100px; border-bottom: 2px solid #eee; margin-bottom: 15px; font-size: 18px; color: #444; }
        .item { padding: 8px 0; border-bottom: 1px solid #f1f1f1; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ */
        .btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn-save { background: #0d6efd; color: white; padding: 8px; font-size: 14px; }
        .btn-voice { background: #dc3545; color: white; box-shadow: 0 4px 0 #b02a37; }
        .btn-voice:active { transform: translateY(4px); box-shadow: none; }
        .btn-print { background: #198754; color: white; }
        
        .status-badge { font-size: 12px; padding: 4px 8px; border-radius: 5px; background: #eee; color: #666; display: inline-block; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card setting-section">
        <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</h3>
        <label>IP Xprinter (LAN):</label>
        <input type="text" id="printer-ip" placeholder="‡πÄ‡∏ä‡πà‡∏ô 192.168.1.100">
        <button class="btn btn-save" onclick="savePrinter()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</button>
        <div id="printer-status" class="status-badge">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏≠‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</div>
    </div>

    <div class="card">
        <h3>üìù ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡πÇ‡∏ï‡πä‡∏∞ <input type="number" id="table-no" style="width: 60px; display: inline; border: none; border-bottom: 2px solid #333; padding: 2px; margin: 0 5px;" placeholder="0">)</h3>
        <div id="display-list">
            <p style="color: #999;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î‡πÄ‡∏°‡∏ô‡∏π...</p>
        </div>
        
        <button class="btn btn-voice" onclick="startVoice()">üé§ ‡∏û‡∏π‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        <button class="btn btn-print" onclick="sendToXprinter()">üñ®Ô∏è ‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà Xprinter</button>
        <button onclick="clearOrder()" style="background: none; border: none; color: #999; width: 100%; margin-top: 15px; cursor: pointer;">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</button>
    </div>
</div>

<script>
    let orders = [];
    
    // ‡πÇ‡∏´‡∏•‡∏î IP ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏≠‡∏î‡πÑ‡∏ß‡πâ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    window.onload = function() {
        const savedIP = localStorage.getItem('xprinter_ip');
        if (savedIP) {
            document.getElementById('printer-ip').value = savedIP;
            document.getElementById('printer-status').innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö " + savedIP;
            document.getElementById('printer-status').style.background = "#d1e7dd";
            document.getElementById('printer-status').style.color = "#0f5132";
        }
    };

    function savePrinter() {
        const ip = document.getElementById('printer-ip').value;
        if (ip) {
            localStorage.setItem('xprinter_ip', ip);
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
            location.reload(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        }
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'th-TH';

    function startVoice() {
        recognition.start();
    }

    recognition.onresult = (event) => {
        const text = event.results[0][0].transcript;
        orders.push(text);
        renderOrders();
    };

    function renderOrders() {
        const list = document.getElementById('display-list');
        if (orders.length === 0) {
            list.innerHTML = '<p style="color: #999;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏π‡∏î‡πÄ‡∏°‡∏ô‡∏π...</p>';
            return;
        }
        list.innerHTML = orders.map((item, i) => `<div class="item">${i+1}. ${item}</div>`).join('');
    }

    async function sendToXprinter() {
        const ip = localStorage.getItem('xprinter_ip');
        const table = document.getElementById('table-no').value || "0";

        if (!ip) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏≠‡∏î IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
        if (orders.length === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå");

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
        let billData = `Table: ${table}\n----------------\n`;
        orders.forEach((item, i) => { billData += `${i+1}. ${item}\n`; });
        billData += `----------------\n\n\n\n`;

        try {
            // ‡∏¢‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà Xprinter ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ï 80 (Web Interface)
            await fetch(`http://${ip}/cgi-bin/print`, {
                method: 'POST',
                mode: 'no-cors',
                body: billData
            });
            alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        } catch (e) {
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: " + e.message);
        }
    }

    function clearOrder() {
        orders = [];
        renderOrders();
    }
</script>

</body>
</html>
